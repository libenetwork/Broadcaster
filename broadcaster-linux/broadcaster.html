<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->


    <title>Broadcaster</title>
    <link rel = "stylesheet" href="css/gtk4web.css">
    <link rel = "stylesheet" href="css/fonts.css">
    <link rel = "stylesheet" href="css/style.css">
    <script src = "js/anime.min.js"></script>
    <link rel = "icon" href="img/icon1024.png">
    <link rel = "stylesheet" href = "css/materialize.min.css">
    <link rel = "stylesheet" href = "css/broadcaster_style.css">
    <script src="js/communicator.js"></script>

</head>
<body>

<div class = "gtk-window main-window" style="">
    <div class = "gtkheader">

        <img class = "add_icon" src="symbols/plus-large-square-outline-symbolic.svg">
        <div>
            <div class="tab active"><img class="tab_icon" src="symbols/skull-symbolic.svg">Сцена 1</div>
        </div>
        <div class="close">
            <img class = "close_icon" src="symbols/close.svg">
        </div>
    </div>
    <div class = "content row" style="margin: 0;">
        <div class="frame col s12 m12 l9 xl7" style=" margin-top: 0.5em;  padding: 0">
           <div class="video-container">
               <div class = "no-video"><img src="symbols/eye-not-looking-symbolic.svg" class = "disactive_icon" style ="height: 7vh">
               </div> <div class="no-video"> <p class="no-sources-text">Відкрийте сцену, аби почати трансляцію</p></div>

            <video id="video" style = "width: 100%; height: 100%; object-fit: fill" class="not-show" autoplay playsinline muted style="
"></video></div>
            <div class="button_row">
                <div class = "gtkbutton" id = "open_scene"><img class="button_icon"  src="symbols/explore2-large-symbolic.svg">Відкрити сцену</div>
                <div class = "gtkbutton"><img class="button_icon" src="symbols/podcast-symbolic.svg">Почати трансляції</div>
                <div class = "gtkbutton"><img src="symbols/donut.svg">Пожертви</div>
                <div class = "gtkbutton live-button"><img class="button_icon" src="symbols/media-record-symbolic.svg">Вийти в етер!</div>
            </div>

            <div class="button_row" id = "comments">
                <div class = "gtkbutton" ><img style="width: 15pt" src="symbols/chat-bubbles-empty-inverted-symbolic.png">Подивитися коментарі</div>

            </div>
            <div class="audio_sources">
                <div class = "preferences-group">
                    <div class = 'preferences_header'><div class = "caption"><div class = "preferences_caption">Авдіо джерела</div><div class="preferences_subcaption">Додайте джерело авдіо, що мусить бути в трансляції</div> </div>
                        <div class = "preferences_sufix"><img class = "sufix_icon button_icon" src="symbols/plus-large-symbolic.svg">Додайте джерела</div></div>
                    <div class = "no-sources">
                        <img class = 'disactive_icon no-source-icon' src = "symbols/sound-wave-alt-symbolic.svg">
                        <div class = "no-sources-text">Нема звуку. Без звуку неможливо почати трансляцію</div>
                    </div>
                </div>
            </div>
    </div>



</div>

</div>
<script src = "js/broadcaster.js"></script>
<script src = "js/youtube_auth.js"></script>
<script src="js/gtk4web.js"></script>
<script type="module" src = "gtk.js"></script>
<script type = "module" src = "theme.js"></script>
<script>
    wc.addEventListener("message", (e) =>
    {

        switch (e.data){
            case "connected":
                alert("Поширте вікно створенної сцени");

                    ipc.send("get-frame");
                    ipc.on("frame_id", async (e, source) => {
                        try {

                            let stream = await navigator.mediaDevices.getUserMedia({
                                audio: {
                                    mandatory: {
                                        chromeMediaSource: 'desktop'
                                    }
                                },
                                video: {
                                    mandatory: {
                                        chromeMediaSource: 'desktop',
                                        chromeMediaSourceId: source,


                                    }
                                }
                            });
                            let delete_elem = document.getElementsByClassName("no-video");
                            for (let i = 0; i < delete_elem.length; i++){
                                delete_elem[i].style.display = "none";
                            }
                            document.getElementById("video").classList.remove("not-show");
                            document.getElementById("video").srcObject = stream;
                            document.getElementsByClassName("no-sources")[0].classList.add("not-show");
                           // wc.postMessage("connected")
                        }catch (e){
                            console.log(e);
                        }



    });
    break;
        }
    });
</script>
<script src = "js/communicator.js"></script>
<script src = "js/coockie.js"></script>
<script type="module" src="https://cdn.jsdelivr.net/npm/@gradio/client@0.1.4/dist/index.min.js"></script>
<script src = "js/audio.js"></script>
<script src="js/donate.js"></script>
<script src="js/generate.js" type="module"></script>
<script src = "js/sources.js"></script>
<script src = "js/grab.js"></script>
</body>
</html>


